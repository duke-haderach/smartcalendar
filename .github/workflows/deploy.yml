name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Allows manual trigger

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pages: write
      id-token: write
      
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Pages
      uses: actions/configure-pages@v3
      
    - name: Create Config File from Secrets
      run: |
        cat > config.js << 'EOF'
        // Auto-generated from GitHub Secrets
        // DO NOT EDIT - Generated on: $(date)
        
        window.DASHBOARD_CONFIG = {
          GITHUB: {
            PERSONAL_ACCESS_TOKEN: '${{ secrets.GITHUB_TOKEN }}',
            GIST_ID: '',
            GIST_FILENAME: 'credit-cards-dashboard.json'
          },
          
          GOOGLE: {
            YOUTUBE_API_KEY: '${{ secrets.YOUTUBE_API_KEY }}',
            CLIENT_ID: '${{ secrets.GOOGLE_CALENDAR_CLIENT_ID }}',
            API_KEY: '${{ secrets.GOOGLE_CALENDAR_API_KEY }}',
            CALENDAR_ID: 'family03331431524389313579@group.calendar.google.com'
          },
          
          WEATHER: {
            LATITUDE: 38.81,
            LONGITUDE: -90.72
          },
          
          FEATURES: {
            VOICE_ALERTS: true,
            CLOUD_SYNC: true,
            YOUTUBE_PLAYER: true
          }
        };
        
        console.log('âœ… Dashboard config loaded from GitHub Secrets');
        EOF
        
        # Also create a .env file for reference
        cat > .env.production << EOF
        # Production Environment Variables
        # Auto-generated from GitHub Secrets
        GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}
        YOUTUBE_API_KEY=${{ secrets.YOUTUBE_API_KEY }}
        GOOGLE_CLIENT_ID=${{ secrets.GOOGLE_CALENDAR_CLIENT_ID }}
        GOOGLE_API_KEY=${{ secrets.GOOGLE_CALENDAR_API_KEY }}
        EOF
        
    - name: Build (if needed - minify, bundle, etc.)
      run: |
        # Optional: Minify your JS files
        # npm install -g uglify-js
        # uglifyjs main.js -o main.min.js
        
        echo "Build step completed"
        
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v2
      with:
        path: '.'
        
    - name: Deploy to GitHub Pages
      uses: actions/deploy-pages@v2
